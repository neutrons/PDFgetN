C
C $Id: misc.f,v 1.1 2006/03/12 09:59:25 tproffen Exp $
C
C
	FUNCTION POLY3(X,P)
	REAL*4 P(3)
	POLY3=P(1)+P(2)*X+P(3)*X*X
	RETURN
	END
C
	FUNCTION POLY4(X,P)
	REAL*4 P(4)
	X2=X*X
	POLY4=P(1)+P(2)*X+P(3)*X2+P(4)*X2*X
	RETURN
	END
C
	SUBROUTINE CALP3(M,N,F,P)
	REAL*4 F(20),P(3)
	COMMON/DATA/R(50),D(50)
	DO 10 I=1,M
	F(I)=D(I)-POLY3(R(I),P)
10	CONTINUE
	RETURN
	END
C
	SUBROUTINE CALP4(M,N,F,P)
	REAL*4 F(20),P(4)
	COMMON/DATA/R(50),D(50)
	DO 10 I=1,M
	F(I)=D(I)-POLY4(R(I),P)
10	CONTINUE
	RETURN
	END
C
      SUBROUTINE FLUX(XLAM)
C--------------------------
C     PARAMETERS FOR METHANE MODERATOR
C     FLUX AS OF JULY 86
C----------------------
	COMMON/DETPAR/DENDET,RDET,XF,SN,C1,C2,C3
C FINDS ANALYTICAL FORM FOR FLUX DIST AND DETR EFF IN SEPD
      PI=4.0*ATAN(1.)
      E= 81.787/XLAM/XLAM
C-----SOURCE SPECTRUM
      EP= E*1.01
      EM= E*0.99
      EREF=1000.0
      B=36164.0
      A=B*1.0867
      ET= 10.704
      ALPHA=0.02315
      ECO= 69.356
      ESS= 1.7587
      DP=1.0/(1.0+(ECO/EP)**ESS)
      DM=1.0/(1.0+(ECO/EM)**ESS)
      PP=A*EP/ET/ET*EXP(-EP/ET)+B*DP/EP*(EP/EREF)**ALPHA
      PM=A*EP/ET/ET*EXP(-EM/ET)+B*DM/EM*(EM/EREF)**ALPHA
      XN=(PM-PP)/(EP-EM)*(EP+EM)/(PP+PM)
C-----DETECTOR EFF
      SIGDET=DENDET*XLAM
      X=SIGDET*RDET*PI/2.0*(1.0-0.03125*XLAM)
      EFF=(1.0-EXP(-X))
      Y=SIGDET*RDET*PI/2.0*(1.0-0.0625*XLAM)
      XR=(Y*EXP(-X))/EFF
        C1=(1.0-XF)+2.0*XN*XF+(1.0-XR)*(1.0-XF)
        C2=XF*(1.0-2.0*XN)*(1.0+2.0*XN*XF)
     1-(1.0-XR)*(1.0-XF)*(3.0-2.0*XF-XR+XR*XF+4.0*XN*XF)
        C3=XF*(1.0+2.0*XN)*(1.0-2.0*XF-2.0*XN*XF)
     1-(1.0-XR)*(1.0-XF)*(1.0+2.0*XF-XR+XR*XF+4.0*XN*XF)
      RETURN 
      END

